<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        
        <!-- Portal Menu Extension -->
        <template id="portal_my_home_menu_kcca" name="Portal layout : KCCA Performance menu entries" inherit_id="portal.portal_breadcrumbs" priority="40">
            <xpath expr="//ol[hasclass('o_portal_submenu')]" position="inside">
                <li t-if="page_name == 'kcca_performance'" t-attf-class="breadcrumb-item #{'active ' if not strategic_goal else ''}">
                    <a t-if="strategic_goal" t-attf-href="/my/kcca_performance?{{ keep_query() }}">KCCA Performance</a>
                    <t t-else="">KCCA Performance</t>
                </li>
                <li t-if="strategic_goal" class="breadcrumb-item active">
                    <t t-esc="strategic_goal.name"/>
                </li>
            </xpath>
        </template>

        <!-- Portal Home Counter -->
        <template id="portal_my_home_kcca_performance" name="Portal My Home : KCCA Performance entries" inherit_id="portal.portal_my_home" priority="40">
            <div id="portal_client_category" position="inside">
                <t t-call="portal.portal_docs_entry">
                    <t t-set="title">KCCA Performance</t>
                    <t t-set="url" t-value="'/my/kcca_performance'"/>
                    <t t-set="placeholder_count" t-value="'kcca_performance_count'"/>
                </t>
            </div>
        </template>

        <!-- Main Portal Performance Page -->
        <template id="portal_kcca_performance" name="KCCA Performance Portal">
            <t t-call="portal.portal_layout">
                <t t-set="breadcrumbs_searchbar" t-value="True"/>

                <t t-call="portal.portal_searchbar">
                    <t t-set="title">KCCA Performance Dashboard</t>
                </t>

                <div class="container-fluid">
                    <!-- Summary Cards -->
                    <div class="row mb-4">
                        <div class="col-md-3">
                            <div class="card text-center">
                                <div class="card-body">
                                    <h2 class="text-primary" t-esc="summary_stats['total_goals']"/>
                                    <p class="card-text">Strategic Goals</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card text-center">
                                <div class="card-body">
                                    <h2 class="text-info" t-esc="summary_stats['total_directorates']"/>
                                    <p class="card-text">Directorates</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card text-center">
                                <div class="card-body">
                                    <h2 class="text-success" t-esc="summary_stats['total_programmes']"/>
                                    <p class="card-text">Programmes</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card text-center">
                                <div class="card-body">
                                    <h2 class="text-warning" t-esc="summary_stats['total_kpis']"/>
                                    <p class="card-text">KPIs</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Performance Overview -->
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5>Strategic Goals Progress</h5>
                                </div>
                                <div class="card-body">
                                    <div class="progress mb-2">
                                        <div class="progress-bar" role="progressbar" 
                                             t-attf-style="width: #{summary_stats['avg_goal_progress']}%"
                                             t-attf-aria-valuenow="#{summary_stats['avg_goal_progress']}" 
                                             aria-valuemin="0" aria-valuemax="100">
                                            <t t-esc="'%.1f' % summary_stats['avg_goal_progress']"/>%
                                        </div>
                                    </div>
                                    <small class="text-muted">Average progress across all strategic goals</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5>Programme Performance</h5>
                                </div>
                                <div class="card-body">
                                    <div class="progress mb-2">
                                        <div class="progress-bar bg-success" role="progressbar" 
                                             t-attf-style="width: #{summary_stats['avg_programme_performance']}%"
                                             t-attf-aria-valuenow="#{summary_stats['avg_programme_performance']}" 
                                             aria-valuemin="0" aria-valuemax="100">
                                            <t t-esc="'%.1f' % summary_stats['avg_programme_performance']"/>%
                                        </div>
                                    </div>
                                    <small class="text-muted">Average performance across all programmes</small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Strategic Goals List -->
                    <div class="row mb-4">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-header">
                                    <h5>Strategic Goals</h5>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <t t-foreach="strategic_goals" t-as="goal">
                                            <div class="col-md-6 mb-3">
                                                <div class="card border-left-primary">
                                                    <div class="card-body">
                                                        <h6 class="card-title">
                                                            <a t-attf-href="/my/kcca_performance/goal/#{goal.id}" 
                                                               class="text-decoration-none" t-esc="goal.name"/>
                                                        </h6>
                                                        <div class="progress mb-2">
                                                            <div class="progress-bar" role="progressbar" 
                                                                 t-attf-style="width: #{goal.progress}%">
                                                                <t t-esc="'%.1f' % goal.progress"/>%
                                                            </div>
                                                        </div>
                                                        <small class="text-muted">
                                                            <t t-esc="goal.objective_count"/> Objectives, 
                                                            <t t-esc="goal.kra_count"/> KRAs, 
                                                            <t t-esc="goal.kpi_count"/> KPIs
                                                        </small>
                                                    </div>
                                                </div>
                                            </div>
                                        </t>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Directorates Performance -->
                    <div class="row">
                        <div class="col-12">
                            <div class="card">
                                <div class="card-header">
                                    <h5>Directorate Performance</h5>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-striped">
                                            <thead>
                                                <tr>
                                                    <th>Directorate</th>
                                                    <th>Performance</th>
                                                    <th>Programmes</th>
                                                    <th>KPIs</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <t t-foreach="directorates" t-as="directorate">
                                                    <tr>
                                                        <td>
                                                            <a t-attf-href="/my/kcca_performance/directorate/#{directorate.id}" 
                                                               class="text-decoration-none" t-esc="directorate.name"/>
                                                        </td>
                                                        <td>
                                                            <div class="progress" style="height: 20px;">
                                                                <div class="progress-bar" role="progressbar" 
                                                                     t-attf-style="width: #{directorate.overall_performance}%">
                                                                    <t t-esc="'%.1f' % directorate.overall_performance"/>%
                                                                </div>
                                                            </div>
                                                        </td>
                                                        <td t-esc="directorate.programme_count"/>
                                                        <td t-esc="directorate.kpi_count"/>
                                                    </tr>
                                                </t>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </t>
        </template>



    </data>
</odoo>
