<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>

        <!-- Programme-Directorate Relationship Tree View -->
        <record id="view_programme_directorate_rel_tree" model="ir.ui.view">
            <field name="name">programme.directorate.rel.tree</field>
            <field name="model">programme.directorate.rel</field>
            <field name="arch" type="xml">
                <list string="Programme-Directorate Relationships"
                      decoration-info="implementation_role=='primary'"
                      decoration-muted="not active"
                      default_order="programme_sequence,directorate_sequence">
                    <field name="programme_name" string="Programme" width="300px"/>
                    <field name="directorate_name" string="Implementing Directorate" width="200px"/>
                    <field name="implementation_role" string="Role" width="100px"/>
                    <field name="responsibility_percentage" string="Responsibility %" width="120px"/>
                    <field name="strategic_objective_name" string="Strategic Objective" optional="hide" width="250px"/>
                    <field name="master_table_row" string="Master Table Row" optional="hide" width="80px"/>
                    <field name="active" string="Active" width="80px"/>
                    <field name="programme_sequence" invisible="1"/>
                    <field name="directorate_sequence" invisible="1"/>
                    <field name="programme_id" invisible="1"/>
                    <field name="directorate_id" invisible="1"/>
                    <field name="strategic_objective_id" invisible="1"/>
                </list>
            </field>

        </record>

        <!-- Legacy 'tree' view provided for backward compatibility with legacy routes -->
        <record id="view_programme_directorate_rel_tree_legacy" model="ir.ui.view">
            <field name="name">programme.directorate.rel.tree.legacy</field>
            <field name="model">programme.directorate.rel</field>
            <field name="arch" type="xml">
                <list string="Programme-Directorate Relationships (Legacy)">
                    <field name="programme_name"/>
                    <field name="directorate_name"/>
                    <field name="implementation_role"/>
                    <field name="responsibility_percentage"/>
                    <field name="active"/>
                </list>
            </field>
        </record>

        <!-- Backward-compatibility Tree View for routes expecting 'tree' type -->
        <record id="view_programme_directorate_rel_tree_compat" model="ir.ui.view">
            <field name="name">programme.directorate.rel.tree.compat</field>
            <field name="model">programme.directorate.rel</field>
            <field name="arch" type="xml">
                <list string="Programme-Directorate Relationships (Compat)"
                      decoration-info="implementation_role=='primary'"
                      decoration-muted="not active">
                    <field name="programme_name" string="Programme"/>
                    <field name="directorate_name" string="Implementing Directorate"/>
                    <field name="implementation_role" string="Role"/>
                    <field name="responsibility_percentage" string="Responsibility %"/>
                    <field name="strategic_objective_name" string="Strategic Objective" optional="hide"/>
                    <field name="master_table_row" string="Master Table Row" optional="hide"/>
                    <field name="active" string="Active"/>
                    <field name="programme_id" invisible="1"/>
                    <field name="directorate_id" invisible="1"/>
                    <field name="strategic_objective_id" invisible="1"/>
                </list>
            </field>
        </record>
        <!-- Programme-Directorate Relationship Form View -->
        <record id="view_programme_directorate_rel_form" model="ir.ui.view">
            <field name="name">programme.directorate.rel.form</field>
            <field name="model">programme.directorate.rel</field>
            <field name="arch" type="xml">
                <form string="Programme-Directorate Relationship" class="pdrel_form">
                    <header>
                        <field name="active" widget="boolean_toggle"/>
                    </header>
                    <sheet>
                        <div class="oe_button_box" name="button_box">
                            <button name="action_view_performance_indicators"
                                    type="object"
                                    class="oe_stat_button"
                                    icon="fa-tachometer"
                                    >
                                <field name="performance_indicator_count" widget="statinfo" string="Performance Indicators"/>
                            </button>

                            <button name="action_view_piap_actions"
                                    type="object"
                                    class="oe_stat_button"
                                    icon="fa-tasks"
                                    invisible="piap_action_count == 0">
                                <field name="piap_action_count" widget="statinfo" string="PIAP Actions"/>
                            </button>

                            <button name="action_view_outputs"
                                    type="object"
                                    class="oe_stat_button"
                                    icon="fa-cube"
                                    invisible="output_count == 0">
                                <field name="output_count" widget="statinfo" string="Outputs"/>
                            </button>

                            <button name="action_view_interventions"
                                    type="object"
                                    class="oe_stat_button"
                                    icon="fa-cogs"
                                    invisible="intervention_count == 0">
                                <field name="intervention_count" widget="statinfo" string="Interventions"/>
                            </button>

                            <button name="action_view_intermediate_outcomes"
                                    type="object"
                                    class="oe_stat_button"
                                    icon="fa-bullseye"
                                    invisible="intermediate_outcome_count == 0">
                                <field name="intermediate_outcome_count" widget="statinfo" string="Intermediate Outcomes"/>
                            </button>

                        </div>
                        <!-- notebook moved below relationship info for better layout in Odoo 18 -->

                        <div class="oe_title">
                            <h1>
                                <field name="display_name" readonly="1"/>
                            </h1>
                        </div>


                        <!-- Professional Performance Overview (compact) -->
                        <group name="performance_overview" string="Performance Overview" colspan="4" class="kcca-highlight" modifiers="{'invisible': [('owned_indicator_count','=',0)]}">
                            <group col="4" class="o_inner_group">
                                <field name="normalized_achievement_percent" widget="progressbar" string="Overall Achievement (%)" readonly="1"/>
                                <field name="performance_status" string="Status" readonly="1"/>
                                <field name="owned_indicator_count" string="Owned KPIs" readonly="1"/>
                                <field name="all_indicator_count" string="Total KPIs (Programme)" readonly="1"/>
                            </group>
                            <separator string=""/>
                            <div class="o_row" modifiers="{'invisible': [('owned_indicator_count','=',0)]}" style="margin:4px 0 8px 0; font-size:12px; color:#666;">
                                <span class="o_form_label" style="margin-right:4px;">Snapshot:</span>
                                <span>This relationship owns </span><field name="owned_indicator_count" nolabel="1" readonly="1" style="display:inline-block; width:auto;"/><span> indicator(s) contributing to programme performance.</span>
                            </div>
                        </group>


                        <group>
                            <group name="relationship_info" string="Relationship Information" class="kcca-highlight">
                                <field name="programme_id" options="{'no_create': True}"/>
                                <field name="directorate_id" options="{'no_create': True}"/>
                                <field name="strategic_objective_id" options="{'no_create': True}"/>
                                <field name="master_table_row"/>
                            </group>

                            <group name="implementation_details" string="Implementation Details" class="kcca-highlight">
                                <field name="implementation_role"/>
                                <field name="responsibility_percentage"/>
                            </group>
                        </group>

                        <group name="computed_fields" string="Reference &amp; Status" colspan="4" class="kcca-highlight">
                            <group>
                                <field name="programme_name" readonly="1"/>
                                <field name="directorate_name" readonly="1"/>
                                <field name="strategic_objective_name" readonly="1"/>
                            </group>
                            <group>
                                <field name="programme_sequence" readonly="1"/>
                                <field name="directorate_sequence" readonly="1"/>
                                <field name="strategic_objective_sequence" readonly="1"/>
                            </group>
                        </group>

                        <notebook>
                            <page string="Owned Performance Indicators">
                                <group col="1">
                                    <field name="contributing_indicator_ids" options="{'no_create': True, 'no_create_edit': True, 'no_quick_create': True}" readonly="1" nolabel="1">
                                        <list string="Owned Performance Indicators" create="0" edit="0" delete="0"
                                              decoration-success="status == 'achieved'"
                                              decoration-warning="status in ('lagging','at_risk')"
                                              decoration-danger="status in ('not_started','critical')">
                                            <field name="name" string="Indicator"/>
                                            <field name="current_value" string="Current"/>
                                            <field name="target_value" string="Target" optional="hide"/>
                                            <field name="achievement_percentage" widget="progressbar" string="Achv (%)"/>
                                            <field name="status" string="Status"/>
                                            <field name="contribution_weight" string="Weight" optional="hide"/>
                                            <field name="strategic_kpi_ids" string="Strategic Links" optional="hide"/>
                                            <field name="write_date" string="Last Update" optional="hide"/>
                                        </list>
                                    </field>
                                    <div modifiers="{'invisible': [('owned_indicator_count','&gt;',0)]}" class="alert alert-info" role="status">
                                        No owned indicators yet. Use the Performance Indicators screen to attribute KPIs to this directorate.
                                    </div>
                                </group>
                            </page>
                        </notebook>

                    </sheet>
                    <chatter/>
                </form>
            </field>
        </record>

        <!-- Programme-Directorate Relationship Kanban View -->
        <record id="view_programme_directorate_rel_kanban" model="ir.ui.view">
            <field name="name">programme.directorate.rel.kanban</field>
            <field name="model">programme.directorate.rel</field>
            <field name="arch" type="xml">
                <kanban default_group_by="directorate_name" class="o_kanban_small_column">
                    <field name="programme_name"/>
                    <field name="directorate_name"/>
                    <field name="implementation_role"/>
                    <field name="responsibility_percentage"/>
                    <field name="strategic_objective_name"/>
                    <field name="active"/>
                    <templates>
                        <t t-name="kanban-box">
                            <div t-attf-class="oe_kanban_card oe_kanban_global_click #{!record.active.raw_value ? 'o_kanban_color_2' : ''}">
                                <div class="o_kanban_content">
                                    <div class="o_kanban_record_top">
                                        <div class="o_kanban_record_headings">
                                            <strong class="o_kanban_record_title">
                                                <field name="programme_name"/>
                                            </strong>
                                        </div>
                                        <div class="o_kanban_record_body">
                                            <div>
                                                <i class="fa fa-building-o" title="Implementing Directorate"/> <field name="directorate_name"/>
                                            </div>
                                            <div t-if="record.implementation_role.raw_value">
                                                <i class="fa fa-user" title="Implementation Role"/> <field name="implementation_role"/>
                                            </div>


                                        </div>
                                    </div>
                                </div>
                            </div>
                        </t>
                    </templates>
                </kanban>
            </field>
        </record>

        <!-- Programme-Directorate Relationship Search View -->
        <record id="view_programme_directorate_rel_search" model="ir.ui.view">
            <field name="name">programme.directorate.rel.search</field>
            <field name="model">programme.directorate.rel</field>
            <field name="arch" type="xml">
                <search string="Programme-Directorate Relationships">
                    <field name="programme_id" string="Programme"/>
                    <field name="directorate_id" string="Directorate"/>
                    <field name="strategic_objective_id" string="Strategic Objective"/>
                    <field name="implementation_role" string="Role"/>

                    <filter name="active" string="Active" domain="[('active', '=', True)]"/>
                    <filter name="inactive" string="Inactive" domain="[('active', '=', False)]"/>

                    <separator/>
                    <filter name="primary_implementer" string="Primary Implementer"
                            domain="[('implementation_role', '=', 'primary')]"/>
                    <filter name="supporting_implementer" string="Supporting Implementer"
                            domain="[('implementation_role', '=', 'supporting')]"/>
                    <filter name="coordinating_role" string="Coordinating Role"
                            domain="[('implementation_role', '=', 'coordinating')]"/>
                    <filter name="monitoring_role" string="Monitoring Role"
                            domain="[('implementation_role', '=', 'monitoring')]"/>

                    <separator/>

                        <separator/>
                        <filter name="perf_achieved" string="Achieved (≥100%)" domain="[('normalized_achievement_percent','&gt;=',100)]"/>
                        <filter name="perf_high" string="High (80–99%)" domain="[('normalized_achievement_percent','&gt;=',80),('normalized_achievement_percent','&lt;',100)]"/>
                        <filter name="perf_medium" string="Medium (50–79%)" domain="[('normalized_achievement_percent','&gt;=',50),('normalized_achievement_percent','&lt;',80)]"/>
                        <filter name="perf_low" string="Low (1–49%)" domain="[('normalized_achievement_percent','&gt;',0),('normalized_achievement_percent','&lt;',50)]"/>
                        <filter name="perf_none" string="No Indicators" domain="[('owned_indicator_count','=',0)]"/>
                        <filter name="has_owned_indicators" string="Has Directorate-Owned Indicators" domain="[('owned_indicator_count','&gt;',0)]"/>

                    <filter name="row_1" string="Row 1" domain="[('master_table_row', '=', 1)]"/>
                    <filter name="row_2" string="Row 2" domain="[('master_table_row', '=', 2)]"/>
                    <filter name="row_3" string="Row 3" domain="[('master_table_row', '=', 3)]"/>
                    <filter name="row_4" string="Row 4" domain="[('master_table_row', '=', 4)]"/>

                        <searchpanel>
                            <field name="programme_id"/>
                            <field name="directorate_id"/>
                            <field name="strategic_objective_id"/>
                            <field name="implementation_role"/>
                        </searchpanel>

                    <filter name="row_5" string="Row 5" domain="[('master_table_row', '=', 5)]"/>

                    <group expand="0" string="Group By">
                        <filter name="group_by_master_table_row" string="Master Table Row"
                                context="{'group_by': 'master_table_row'}"/>
                        <filter name="group_by_programme" string="Programme"
                                context="{'group_by': 'programme_id'}"/>
                        <filter name="group_by_directorate" string="Directorate"
                                context="{'group_by': 'directorate_id'}"/>
                        <filter name="group_by_strategic_objective" string="Strategic Objective"
                                context="{'group_by': 'strategic_objective_id'}"/>
                        <filter name="group_by_implementation_role" string="Implementation Role"
                                context="{'group_by': 'implementation_role'}"/>
                    </group>
                </search>
            </field>
        </record>

        <!-- Programme-Directorate Relationship Action -->
        <record id="action_programme_directorate_rel" model="ir.actions.act_window">
            <field name="name">Programme-Directorate Relationships</field>
            <field name="res_model">programme.directorate.rel</field>
            <field name="view_mode">list,kanban,form</field>
            <field name="search_view_id" ref="view_programme_directorate_rel_search"/>
            <field name="context">{
                'search_default_active': 1
            }</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    Create a new Programme-Directorate Relationship
                </p>
                <p>
                    Programme-Directorate relationships define which directorates are responsible
                    for implementing specific programmes according to the master table structure.
                </p>
            </field>
        </record>

        <!-- Directorate Programme Performance Action -->
        <record id="action_directorate_programme_performance" model="ir.actions.act_window">
            <field name="name">Directorate Programme Performance</field>
            <field name="res_model">programme.directorate.rel</field>
            <field name="view_mode">list,form,kanban</field>
            <field name="search_view_id" ref="view_programme_directorate_rel_search"/>
            <field name="context">{
                'search_default_active': 1,
                'search_default_group_by_directorate': 1
            }</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    Track Directorate Programme Performance
                </p>
                <p>
                    Monitor and evaluate the performance of programmes implemented by each directorate.
                </p>
            </field>
        </record>

        <!-- Strategic Objective Dashboard Views -->
        <record id="view_strategic_objective_dashboard" model="ir.ui.view">
            <field name="name">strategic.objective.dashboard</field>
            <field name="model">programme.directorate.rel</field>
            <field name="arch" type="xml">
                <kanban class="o_kanban_dashboard" default_group_by="strategic_objective_id">
                    <field name="strategic_objective_id"/>
                    <field name="strategic_objective_name"/>
                    <field name="programme_id"/>
                    <field name="programme_name"/>
                    <field name="directorate_id"/>
                    <field name="directorate_name"/>
                    <field name="implementation_role"/>
                    <field name="master_table_row"/>
                    <field name="active"/>
                    <templates>
                        <t t-name="kanban-box">
                            <div class="oe_kanban_card oe_kanban_global_click" style="margin: 5px; border-left: 4px solid #007cba;">
                                <div class="o_kanban_content">
                                    <div class="o_kanban_record_top">
                                        <div class="o_kanban_record_headings">
                                            <strong class="o_kanban_record_title" style="color: #007cba; font-size: 14px;">
                                                <field name="programme_name"/>
                                            </strong>
                                        </div>
                                        <div class="o_kanban_record_body" style="margin-top: 8px;">
                                            <div style="margin-bottom: 4px;">
                                                <span title="Implementing Directorate" style="color: #6c757d;">🏢</span>
                                                <span style="font-weight: 500;"><field name="directorate_name"/></span>
                                            </div>
                                            <div t-if="record.implementation_role.raw_value" style="margin-bottom: 4px;">
                                                <span title="Implementation Role" style="color: #6c757d;">👤</span>
                                                <span class="badge badge-info" style="font-size: 11px;"><field name="implementation_role"/></span>
                                            </div>
                                            <div style="font-size: 11px; color: #6c757d;">
                                                <span title="Master Table Row">📋 Row </span><field name="master_table_row"/>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </t>
                    </templates>
                </kanban>
            </field>
        </record>

        <!-- Strategic Objective List View -->
        <record id="view_strategic_objective_list" model="ir.ui.view">
            <field name="name">strategic.objective.list</field>
            <field name="model">programme.directorate.rel</field>
            <field name="arch" type="xml">
                <list string="Strategic Implementation Overview" default_group_by="strategic_objective_id">
                    <field name="strategic_objective_name" string="Strategic Objective"/>
                    <field name="programme_name" string="Programme"/>
                    <field name="directorate_name" string="Implementing Directorate"/>
                    <field name="implementation_role" string="Role"/>
                    <field name="master_table_row" string="Row" optional="hide"/>
                    <field name="active" string="Active"/>
                </list>
            </field>
        </record>

        <!-- Strategic Objective Dashboard Action -->
        <record id="action_strategic_objective_dashboard" model="ir.actions.act_window">
            <field name="name">Strategic Objective Dashboard</field>
            <field name="res_model">programme.directorate.rel</field>
            <field name="view_mode">kanban,list</field>
            <field name="view_ids" eval="[(5, 0, 0),
                                          (0, 0, {'view_mode': 'kanban', 'view_id': ref('view_strategic_objective_dashboard')}),
                                          (0, 0, {'view_mode': 'list', 'view_id': ref('view_strategic_objective_list')})]"/>
            <field name="search_view_id" ref="view_programme_directorate_rel_search"/>
            <field name="context">{
                'search_default_active': 1,
                'search_default_group_by_strategic_objective': 1
            }</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    Strategic Implementation Overview
                </p>
                <p>
                    This dashboard shows how programmes are organized under strategic objectives
                    and which directorates are responsible for implementing each programme.
                    Clear, intuitive grouping by strategic objective makes it easy to understand
                    the implementation structure.
                </p>
            </field>
        </record>

        <!-- Keep the old action for backward compatibility but redirect to new one -->
        <record id="action_master_table_dashboard" model="ir.actions.act_window">
            <field name="name">Master Table Dashboard</field>
            <field name="res_model">programme.directorate.rel</field>
            <field name="view_mode">kanban,list</field>
            <field name="view_ids" eval="[(5, 0, 0),
                                          (0, 0, {'view_mode': 'kanban', 'view_id': ref('view_strategic_objective_dashboard')}),
                                          (0, 0, {'view_mode': 'list', 'view_id': ref('view_strategic_objective_list')})]"/>
            <field name="search_view_id" ref="view_programme_directorate_rel_search"/>
            <field name="context">{
                'search_default_active': 1,
                'search_default_group_by_strategic_objective': 1
            }</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    Strategic Implementation Overview
                </p>
                <p>
                    This dashboard shows how programmes are organized under strategic objectives
                    and which directorates are responsible for implementing each programme.
                </p>
            </field>
        </record>

        <!-- Additional Views for Strategic Implementation Analysis -->
        <record id="view_programme_directorate_rel_pivot" model="ir.ui.view">
            <field name="name">programme.directorate.rel.pivot</field>
            <field name="model">programme.directorate.rel</field>
            <field name="arch" type="xml">
                <pivot string="Strategic Implementation Analysis">
                    <field name="strategic_objective_name" type="row"/>
                    <field name="directorate_name" type="col"/>
                    <field name="id" type="measure"/>
                </pivot>
            </field>
        </record>

        <record id="view_programme_directorate_rel_graph_strategic" model="ir.ui.view">
            <field name="name">programme.directorate.rel.graph.strategic</field>
            <field name="model">programme.directorate.rel</field>
            <field name="arch" type="xml">
                <graph string="Implementation by Strategic Objective" type="bar">
                    <field name="strategic_objective_name" type="row"/>
                    <field name="id" type="measure"/>
                </graph>
            </field>
        </record>

        <!-- Strategic Implementation Analysis Action -->
        <record id="action_strategic_implementation_analysis" model="ir.actions.act_window">
            <field name="name">Strategic Implementation Analysis</field>
            <field name="res_model">programme.directorate.rel</field>
            <field name="view_mode">pivot,graph,list</field>
            <field name="view_ids" eval="[(5, 0, 0),
                                          (0, 0, {'view_mode': 'pivot', 'view_id': ref('view_programme_directorate_rel_pivot')}),
                                          (0, 0, {'view_mode': 'graph', 'view_id': ref('view_programme_directorate_rel_graph_strategic')}),
                                          (0, 0, {'view_mode': 'list', 'view_id': ref('view_strategic_objective_list')})]"/>
            <field name="context">{
                'search_default_active': 1,
                'search_default_group_by_strategic_objective': 1
            }</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    Strategic Implementation Analysis
                </p>
                <p>
                    Analyze how programmes are distributed across strategic objectives and
                    which directorates are responsible for implementing each strategic area.
                </p>
            </field>
        </record>

    </data>
</odoo>
