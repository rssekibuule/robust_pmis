<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>

        <!-- Key Performance Indicator List View -->
        <record id="view_key_performance_indicator_list" model="ir.ui.view">
            <field name="name">key.performance.indicator.list</field>
            <field name="model">key.performance.indicator</field>
            <field name="arch" type="xml">
                <list string="Key Performance Indicators" decoration-muted="not active"
                      decoration-success="status == 'achieved'"
                      decoration-info="status == 'on_track'"
                      decoration-warning="status == 'at_risk'"
                      decoration-danger="status == 'behind'"
                      editable="bottom">
                    <field name="sequence" widget="handle"/>
                    <field name="name" readonly="1"/>
                    <field name="kra_id" readonly="1"/>
                    <field name="directorate_id" readonly="1"/>
                    <field name="baseline_value" readonly="1"/>
                    <field name="current_value"/>
                    <field name="target_value" readonly="1"/>
                    <field name="measurement_unit" readonly="1"/>
                    <field name="achievement_percentage" widget="progressbar" readonly="1"/>
                    <field name="status" readonly="1"/>
                    <field name="active" invisible="1"/>
                </list>
            </field>
        </record>

        <!-- Key Performance Indicator Form View -->
        <record id="view_key_performance_indicator_form" model="ir.ui.view">
            <field name="name">key.performance.indicator.form</field>
            <field name="model">key.performance.indicator</field>
            <field name="arch" type="xml">
                <form string="Key Performance Indicator">
                    <header>
                        <field name="status" widget="statusbar" statusbar_visible="not_started,on_track,achieved"/>
                        <field name="active" widget="boolean_toggle"/>
                    </header>
                    <sheet>
                        <div class="oe_title">
                            <h1>
                                <field name="name" placeholder="KPI Name"/>
                            </h1>
                        </div>

                        <group>
                            <group string="Basic Information">
                                <field name="kra_id"/>
                                <field name="directorate_id"/>
                                <field name="responsible_user_id"/>
                                <field name="sequence"/>
                                <field name="thematic_area"/>
                            </group>
                            <group string="Performance">
                                <field name="achievement_percentage" widget="progressbar"/>
                                <field name="kpi_type"/>
                                <field name="frequency"/>
                            </group>
                        </group>

                        <group>
                            <group string="Values">
                                <field name="current_value"/>
                                <field name="target_value"/>
                                <field name="baseline_value"/>
                                <field name="measurement_unit"/>
                            </group>
                            <group string="Timeline">
                                <field name="start_date"/>
                                <field name="end_date"/>
                            </group>
                        </group>

                        <notebook>
                            <page string="Description">
                                <field name="description" widget="html"/>
                            </page>
                            <page string="Programme Linkages">
                                <group>
                                    <group string="Auto-Calculation Settings">
                                        <field name="auto_calculate"/>
                                        <field name="calculation_method" invisible="auto_calculate == False"/>
                                    </group>
                                    <group string="Programme Indicators">
                                        <field name="contributing_programme_indicators" widget="many2many_tags" invisible="auto_calculate == False"/>
                                    </group>
                                </group>
                                <separator string="Contributing Programme Indicators" invisible="auto_calculate == False"/>
                                <p invisible="auto_calculate == False">
                                    Use the "Setup Programme Linkages" button above to configure detailed linkages with contribution weights and target cascades.
                                </p>
                            </page>
                        </notebook>
                    </sheet>
                    <chatter/>
                </form>
            </field>
        </record>

        <!-- KPI Kanban View -->
        <record id="view_key_performance_indicator_kanban" model="ir.ui.view">
            <field name="name">key.performance.indicator.kanban</field>
            <field name="model">key.performance.indicator</field>
            <field name="arch" type="xml">
                <kanban class="o_kanban_mobile" default_group_by="status">
                    <field name="name"/>
                    <field name="achievement_percentage"/>
                    <field name="current_value"/>
                    <field name="target_value"/>
                    <field name="measurement_unit"/>
                    <field name="status"/>
                    <field name="directorate_id"/>
                    <templates>
                        <t t-name="card">
                            <div class="oe_kanban_card oe_kanban_global_click">
                                <div class="o_kanban_record_top">
                                    <div class="o_kanban_record_headings">
                                        <strong class="o_kanban_record_title">
                                            <field name="name"/>
                                        </strong>
                                        <div class="o_kanban_record_subtitle">
                                            <field name="directorate_id"/>
                                        </div>
                                    </div>
                                </div>
                                <div class="o_kanban_record_body">
                                    <div class="row">
                                        <div class="col-6">
                                            <span>Current: <t t-esc="record.current_value.value"/> <t t-esc="record.measurement_unit.value"/></span><br/>
                                            <span>Target: <t t-esc="record.target_value.value"/> <t t-esc="record.measurement_unit.value"/></span>
                                        </div>
                                        <div class="col-6">
                                            <div class="text-right">
                                                <field name="achievement_percentage" widget="progressbar"/>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </t>
                    </templates>
                </kanban>
            </field>
        </record>

        <!-- KPI Performance Dashboard Search View -->
        <record id="view_key_performance_indicator_search" model="ir.ui.view">
            <field name="name">key.performance.indicator.search</field>
            <field name="model">key.performance.indicator</field>
            <field name="arch" type="xml">
                <search string="KPI Performance Dashboard">
                    <!-- Search Fields -->
                    <field name="name" string="KPI Name" filter_domain="[('name', 'ilike', self)]"/>
                    <field name="kra_id" string="Key Result Area"/>
                    <field name="directorate_id" string="Directorate"/>
                    <field name="responsible_user_id" string="Responsible User"/>
                    <field name="measurement_unit" string="Unit"/>

                    <!-- Performance Filters -->
                    <separator/>
                    <filter string="Active" name="active" domain="[('active', '=', True)]"/>
                    <filter string="Inactive" name="inactive" domain="[('active', '=', False)]"/>

                    <separator/>
                    <filter string="Achieved (100%+)" name="achieved" domain="[('achievement_percentage', '>=', 100)]"/>
                    <filter string="On Track (80-99%)" name="on_track" domain="[('achievement_percentage', '>=', 80), ('achievement_percentage', '&lt;', 100)]"/>
                    <filter string="At Risk (60-79%)" name="at_risk" domain="[('achievement_percentage', '>=', 60), ('achievement_percentage', '&lt;', 80)]"/>
                    <filter string="Behind (&lt;60%)" name="behind" domain="[('achievement_percentage', '&lt;', 60)]"/>
                    <filter string="Not Started (0%)" name="not_started" domain="[('achievement_percentage', '=', 0)]"/>

                    <!-- Status Filters -->
                    <separator/>
                    <filter string="Achieved Status" name="status_achieved" domain="[('status', '=', 'achieved')]"/>
                    <filter string="On Track Status" name="status_on_track" domain="[('status', '=', 'on_track')]"/>
                    <filter string="At Risk Status" name="status_at_risk" domain="[('status', '=', 'at_risk')]"/>
                    <filter string="Behind Schedule" name="status_behind" domain="[('status', '=', 'behind')]"/>

                    <!-- KPI Type Filters -->
                    <separator/>
                    <filter string="Higher is Better" name="type_increasing" domain="[('kpi_type', '=', 'increasing')]"/>
                    <filter string="Lower is Better" name="type_decreasing" domain="[('kpi_type', '=', 'decreasing')]"/>
                    <filter string="Target Value" name="type_target" domain="[('kpi_type', '=', 'target')]"/>

                    <!-- Frequency Filters -->
                    <separator/>
                    <filter string="Daily" name="freq_daily" domain="[('frequency', '=', 'daily')]"/>
                    <filter string="Weekly" name="freq_weekly" domain="[('frequency', '=', 'weekly')]"/>
                    <filter string="Monthly" name="freq_monthly" domain="[('frequency', '=', 'monthly')]"/>
                    <filter string="Quarterly" name="freq_quarterly" domain="[('frequency', '=', 'quarterly')]"/>
                    <filter string="Annual" name="freq_annual" domain="[('frequency', '=', 'annual')]"/>

                    <!-- Group By Options -->
                    <group expand="0" string="Group By">
                        <filter string="Status" name="group_by_status" context="{'group_by': 'status'}"/>
                        <filter string="Key Result Area" name="group_by_kra" context="{'group_by': 'kra_id'}"/>
                        <filter string="Directorate" name="group_by_directorate" context="{'group_by': 'directorate_id'}"/>
                        <filter string="Responsible User" name="group_by_user" context="{'group_by': 'responsible_user_id'}"/>
                        <filter string="KPI Type" name="group_by_type" context="{'group_by': 'kpi_type'}"/>
                        <filter string="Frequency" name="group_by_frequency" context="{'group_by': 'frequency'}"/>
                        <filter string="Measurement Unit" name="group_by_unit" context="{'group_by': 'measurement_unit'}"/>

                    </group>
                </search>
            </field>
        </record>

    </data>
</odoo>
