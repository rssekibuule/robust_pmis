<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>

        <!-- Key Performance Indicator List View -->
        <record id="view_key_performance_indicator_list" model="ir.ui.view">
            <field name="name">key.performance.indicator.list</field>
            <field name="model">key.performance.indicator</field>
            <field name="arch" type="xml">
                <list string="Key Performance Indicators" decoration-muted="not active"
                      decoration-success="status == 'achieved'"
                      decoration-info="status == 'on_track'"
                      decoration-warning="status == 'at_risk'"
                      decoration-danger="status == 'behind'"
                      editable="bottom">
                    <field name="sequence" widget="handle"/>
                    <field name="name" readonly="1"/>
                    <field name="kra_id" readonly="1"/>
                    <field name="directorate_id" readonly="1"/>
                    <field name="classification_level" readonly="1"/>
                    <field name="parent_type" readonly="1"/>
                    <field name="baseline_value" readonly="1"/>
                    <field name="current_value"/>
                    <field name="target_value" readonly="1"/>
                    <field name="measurement_unit" readonly="1"/>
                    <field name="achievement_percentage" widget="progressbar" readonly="1"/>
                    <field name="status" readonly="1"/>
                    <field name="active" invisible="1"/>
                </list>
            </field>
        </record>

        <!-- Key Performance Indicator Form View -->
        <record id="view_key_performance_indicator_form" model="ir.ui.view">
            <field name="name">key.performance.indicator.form</field>
            <field name="model">key.performance.indicator</field>
            <field name="arch" type="xml">
                <form string="Key Performance Indicator">
                    <header>
                        <field name="status" widget="statusbar" statusbar_visible="not_started,on_track,achieved"/>
                        <field name="active" widget="boolean_toggle"/>
                    </header>
                    <sheet>
                        <div class="oe_title">
                            <h1>
                                <field name="name" placeholder="KPI Name"/>
                            </h1>
                        </div>

                        <group>
                            <group string="Basic Information">
                                <field name="kra_id"/>
                                <field name="directorate_id"/>
                                <field name="responsible_user_id"/>
                                <field name="sequence"/>
                                <field name="thematic_area"/>
                            </group>
                            <group string="Performance">
                                <field name="achievement_percentage" widget="progressbar"/>
                                <field name="kpi_type"/>
                                <field name="frequency"/>
                            </group>
                        </group>
                        
                        <group string="Organizational Classification">
                            <group>
                                <field name="classification_level"/>
                                <field name="parent_type"/>
                            </group>
                            <group>
                                <field name="programme_id" invisible="parent_type != 'programme'"/>
                                <field name="division_id" invisible="parent_type != 'division'"/>
                            </group>
                        </group>

                        <group>
                            <group string="Values">
                                <field name="current_value"/>
                                <field name="target_value"/>
                                <field name="baseline_value"/>
                                <field name="measurement_unit"/>
                            </group>
                            <group string="Timeline">
                                <field name="start_date"/>
                                <field name="end_date"/>
                            </group>
                        </group>

                        <notebook>
                            <page string="Description">
                                <field name="description" widget="html"/>
                            </page>
                            <page string="Programme Linkages">
                                <group>
                                    <group string="Auto-Calculation Settings">
                                        <field name="auto_calculate"/>
                                        <field name="calculation_method" invisible="auto_calculate == False"/>
                                    </group>
                                    <group string="Programme Indicators">
                                        <field name="contributing_programme_indicators" widget="many2many_tags" invisible="auto_calculate == False"/>
                                    </group>
                                </group>
                                <separator string="Contributing Programme Indicators" invisible="auto_calculate == False"/>
                                <p invisible="auto_calculate == False">
                                    Use the "Setup Programme Linkages" button above to configure detailed linkages with contribution weights and target cascades.
                                </p>
                            </page>
                        </notebook>
                    </sheet>
                    <chatter/>
                </form>
            </field>
        </record>

        <!-- KPI Kanban View -->
        <record id="view_key_performance_indicator_kanban" model="ir.ui.view">
            <field name="name">key.performance.indicator.kanban</field>
            <field name="model">key.performance.indicator</field>
            <field name="arch" type="xml">
                <kanban class="o_kanban_mobile" default_group_by="status">
                    <field name="name"/>
                    <field name="achievement_percentage"/>
                    <field name="current_value"/>
                    <field name="target_value"/>
                    <field name="measurement_unit"/>
                    <field name="status"/>
                    <field name="directorate_id"/>
                    <templates>
                        <t t-name="card">
                            <div class="oe_kanban_card oe_kanban_global_click">
                                <div class="o_kanban_record_top">
                                    <div class="o_kanban_record_headings">
                                        <strong class="o_kanban_record_title">
                                            <field name="name"/>
                                        </strong>
                                        <div class="o_kanban_record_subtitle">
                                            <field name="directorate_id"/>
                                        </div>
                                    </div>
                                </div>
                                <div class="o_kanban_record_body">
                                    <div class="row">
                                        <div class="col-6">
                                            <span>Current: <t t-out="record.current_value.value"/> <t t-out="record.measurement_unit.value"/></span><br/>
                                            <span>Target: <t t-out="record.target_value.value"/> <t t-out="record.measurement_unit.value"/></span>
                                        </div>
                                        <div class="col-6">
                                            <div class="text-right">
                                                <field name="achievement_percentage" widget="progressbar"/>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </t>
                    </templates>
                </kanban>
            </field>
        </record>

        <!-- KPI Performance Dashboard Search View -->
        <record id="view_key_performance_indicator_search" model="ir.ui.view">
            <field name="name">key.performance.indicator.search</field>
            <field name="model">key.performance.indicator</field>
            <field name="arch" type="xml">
                <search string="KPI Performance Dashboard">
                    <!-- Search Fields -->
                    <field name="name" string="KPI Name" filter_domain="[('name', 'ilike', self)]"/>
                    <field name="kra_id" string="Key Result Area"/>
                    <field name="directorate_id" string="Directorate"/>
                    <field name="responsible_user_id" string="Responsible User"/>
                    <field name="measurement_unit" string="Unit"/>

                    <!-- Financial Year Filters (moved to top) -->
                    <separator string="Financial Year"/>
                    <filter string="FY 2024/25" name="fy_2024_25"
                        domain="['&amp;', ('start_date','&lt;=','2025-06-30'), '|', ('end_date','=',False), ('end_date','>=','2024-07-01')]"/>
                    <filter string="FY 2025/26" name="fy_2025_26"
                        domain="['&amp;', ('start_date','&lt;=','2026-06-30'), '|', ('end_date','=',False), ('end_date','>=','2025-07-01')]"/>
                    <filter string="FY 2026/27" name="fy_2026_27"
                        domain="['&amp;', ('start_date','&lt;=','2027-06-30'), '|', ('end_date','=',False), ('end_date','>=','2026-07-01')]"/>
                    <filter string="FY 2027/28" name="fy_2027_28"
                        domain="['&amp;', ('start_date','&lt;=','2028-06-30'), '|', ('end_date','=',False), ('end_date','>=','2027-07-01')]"/>
                    <filter string="FY 2028/29" name="fy_2028_29"
                        domain="['&amp;', ('start_date','&lt;=','2029-06-30'), '|', ('end_date','=',False), ('end_date','>=','2028-07-01')]"/>

                    <!-- Quarter Filters per FY (Uganda FY: Jul 1 â€“ Jun 30) -->
                    <separator string="Quarters"/>
                    <!-- FY 2024/25 Quarters -->
                    <filter string="FY 2024/25 Q1"
                        name="fy_2024_25_q1"
                        domain="['&amp;', ('start_date','&lt;=','2024-09-30'), '|', ('end_date','=',False), ('end_date','>=','2024-07-01')]"/>
                    <filter string="FY 2024/25 Q2"
                        name="fy_2024_25_q2"
                        domain="['&amp;', ('start_date','&lt;=','2024-12-31'), '|', ('end_date','=',False), ('end_date','>=','2024-10-01')]"/>
                    <filter string="FY 2024/25 Q3"
                        name="fy_2024_25_q3"
                        domain="['&amp;', ('start_date','&lt;=','2025-03-31'), '|', ('end_date','=',False), ('end_date','>=','2025-01-01')]"/>
                    <filter string="FY 2024/25 Q4"
                        name="fy_2024_25_q4"
                        domain="['&amp;', ('start_date','&lt;=','2025-06-30'), '|', ('end_date','=',False), ('end_date','>=','2025-04-01')]"/>
                    <!-- FY 2025/26 Quarters -->
                    <filter string="FY 2025/26 Q1"
                        name="fy_2025_26_q1"
                        domain="['&amp;', ('start_date','&lt;=','2025-09-30'), '|', ('end_date','=',False), ('end_date','>=','2025-07-01')]"/>
                    <filter string="FY 2025/26 Q2"
                        name="fy_2025_26_q2"
                        domain="['&amp;', ('start_date','&lt;=','2025-12-31'), '|', ('end_date','=',False), ('end_date','>=','2025-10-01')]"/>
                    <filter string="FY 2025/26 Q3"
                        name="fy_2025_26_q3"
                        domain="['&amp;', ('start_date','&lt;=','2026-03-31'), '|', ('end_date','=',False), ('end_date','>=','2026-01-01')]"/>
                    <filter string="FY 2025/26 Q4"
                        name="fy_2025_26_q4"
                        domain="['&amp;', ('start_date','&lt;=','2026-06-30'), '|', ('end_date','=',False), ('end_date','>=','2026-04-01')]"/>
                    <!-- FY 2026/27 Quarters -->
                    <filter string="FY 2026/27 Q1"
                        name="fy_2026_27_q1"
                        domain="['&amp;', ('start_date','&lt;=','2026-09-30'), '|', ('end_date','=',False), ('end_date','>=','2026-07-01')]"/>
                    <filter string="FY 2026/27 Q2"
                        name="fy_2026_27_q2"
                        domain="['&amp;', ('start_date','&lt;=','2026-12-31'), '|', ('end_date','=',False), ('end_date','>=','2026-10-01')]"/>
                    <filter string="FY 2026/27 Q3"
                        name="fy_2026_27_q3"
                        domain="['&amp;', ('start_date','&lt;=','2027-03-31'), '|', ('end_date','=',False), ('end_date','>=','2027-01-01')]"/>
                    <filter string="FY 2026/27 Q4"
                        name="fy_2026_27_q4"
                        domain="['&amp;', ('start_date','&lt;=','2027-06-30'), '|', ('end_date','=',False), ('end_date','>=','2027-04-01')]"/>
                    <!-- FY 2027/28 Quarters -->
                    <filter string="FY 2027/28 Q1"
                        name="fy_2027_28_q1"
                        domain="['&amp;', ('start_date','&lt;=','2027-09-30'), '|', ('end_date','=',False), ('end_date','>=','2027-07-01')]"/>
                    <filter string="FY 2027/28 Q2"
                        name="fy_2027_28_q2"
                        domain="['&amp;', ('start_date','&lt;=','2027-12-31'), '|', ('end_date','=',False), ('end_date','>=','2027-10-01')]"/>
                    <filter string="FY 2027/28 Q3"
                        name="fy_2027_28_q3"
                        domain="['&amp;', ('start_date','&lt;=','2028-03-31'), '|', ('end_date','=',False), ('end_date','>=','2028-01-01')]"/>
                    <filter string="FY 2027/28 Q4"
                        name="fy_2027_28_q4"
                        domain="['&amp;', ('start_date','&lt;=','2028-06-30'), '|', ('end_date','=',False), ('end_date','>=','2028-04-01')]"/>
                    <!-- FY 2028/29 Quarters -->
                    <filter string="FY 2028/29 Q1"
                        name="fy_2028_29_q1"
                        domain="['&amp;', ('start_date','&lt;=','2028-09-30'), '|', ('end_date','=',False), ('end_date','>=','2028-07-01')]"/>
                    <filter string="FY 2028/29 Q2"
                        name="fy_2028_29_q2"
                        domain="['&amp;', ('start_date','&lt;=','2028-12-31'), '|', ('end_date','=',False), ('end_date','>=','2028-10-01')]"/>
                    <filter string="FY 2028/29 Q3"
                        name="fy_2028_29_q3"
                        domain="['&amp;', ('start_date','&lt;=','2029-03-31'), '|', ('end_date','=',False), ('end_date','>=','2029-01-01')]"/>
                    <filter string="FY 2028/29 Q4"
                        name="fy_2028_29_q4"
                        domain="['&amp;', ('start_date','&lt;=','2029-06-30'), '|', ('end_date','=',False), ('end_date','>=','2029-04-01')]"/>

                    <!-- Performance Filters -->
                    <separator/>
                    <filter string="Active" name="active" domain="[('active', '=', True)]"/>
                    <filter string="Inactive" name="inactive" domain="[('active', '=', False)]"/>

                    <separator/>
                    <filter string="Achieved (100%+)" name="achieved" domain="[('achievement_percentage', '>=', 100)]"/>
                    <filter string="On Track (80-99%)" name="on_track" domain="[('achievement_percentage', '>=', 80), ('achievement_percentage', '&lt;', 100)]"/>
                    <filter string="At Risk (60-79%)" name="at_risk" domain="[('achievement_percentage', '>=', 60), ('achievement_percentage', '&lt;', 80)]"/>
                    <filter string="Behind (&lt;60%)" name="behind" domain="[('achievement_percentage', '&lt;', 60)]"/>
                    <filter string="Not Started (0%)" name="not_started" domain="[('achievement_percentage', '=', 0)]"/>

                    <!-- Status Filters -->
                    <separator/>
                    <filter string="Achieved Status" name="status_achieved" domain="[('status', '=', 'achieved')]"/>
                    <filter string="On Track Status" name="status_on_track" domain="[('status', '=', 'on_track')]"/>
                    <filter string="At Risk Status" name="status_at_risk" domain="[('status', '=', 'at_risk')]"/>
                    <filter string="Behind Schedule" name="status_behind" domain="[('status', '=', 'behind')]"/>

                    <!-- KPI Type Filters -->
                    <separator/>
                    <filter string="Higher is Better" name="type_increasing" domain="[('kpi_type', '=', 'increasing')]"/>
                    <filter string="Lower is Better" name="type_decreasing" domain="[('kpi_type', '=', 'decreasing')]"/>
                    <filter string="Target Value" name="type_target" domain="[('kpi_type', '=', 'target')]"/>

                    <!-- Frequency Filters (trimmed: remove Daily/Weekly/Monthly) -->
                    <separator/>
                    <filter string="Quarterly" name="freq_quarterly" domain="[('frequency', '=', 'quarterly')]"/>
                    <filter string="Annual" name="freq_annual" domain="[('frequency', '=', 'annual')]"/>
                    
                    <!-- Classification Filters -->
                    <separator string="Classification Filters"/>
                    <filter string="Strategic Level" name="level_strategic" domain="[('classification_level', '=', 'strategic')]"/>
                    <filter string="Operational Level" name="level_operational" domain="[('classification_level', '=', 'operational')]"/>
                    <filter string="Tactical Level" name="level_tactical" domain="[('classification_level', '=', 'tactical')]"/>
                    <filter string="Programme Level" name="level_programme" domain="[('classification_level', '=', 'programme')]"/>
                    <filter string="Division Level" name="level_division" domain="[('classification_level', '=', 'division')]"/>
                    <filter string="Directorate Level" name="level_directorate" domain="[('classification_level', '=', 'directorate')]"/>
                    
                    <separator/>
                    <filter string="Strategic Goal KPIs" name="parent_strategic_goal" domain="[('parent_type', '=', 'strategic_goal')]"/>
                    <filter string="Strategic Objective KPIs" name="parent_strategic_objective" domain="[('parent_type', '=', 'strategic_objective')]"/>
                    <filter string="KRA KPIs" name="parent_kra" domain="[('parent_type', '=', 'kra')]"/>
                    <filter string="Programme KPIs" name="parent_programme" domain="[('parent_type', '=', 'programme')]"/>
                    <filter string="Division KPIs" name="parent_division" domain="[('parent_type', '=', 'division')]"/>
                    <filter string="Directorate KPIs" name="parent_directorate" domain="[('parent_type', '=', 'directorate')]"/>

            <!-- Financial Year & Quarter filters moved to top above -->

                    <!-- Group By Options -->
                    <group expand="0" string="Group By">
                        <filter string="Status" name="group_by_status" context="{'group_by': 'status'}"/>
                        <filter string="Key Result Area" name="group_by_kra" context="{'group_by': 'kra_id'}"/>
                        <filter string="Directorate" name="group_by_directorate" context="{'group_by': 'directorate_id'}"/>
                        <filter string="Responsible User" name="group_by_user" context="{'group_by': 'responsible_user_id'}"/>
                        <filter string="KPI Type" name="group_by_type" context="{'group_by': 'kpi_type'}"/>
                        <filter string="Frequency" name="group_by_frequency" context="{'group_by': 'frequency'}"/>
                        <filter string="Measurement Unit" name="group_by_unit" context="{'group_by': 'measurement_unit'}"/>
                        <!-- New Hierarchy Classification Groups -->
                        <separator/>
                        <filter string="Classification Level" name="group_by_level" context="{'group_by': 'classification_level'}"/>
                        <filter string="Parent Type" name="group_by_parent_type" context="{'group_by': 'parent_type'}"/>
                        <filter string="Programme" name="group_by_programme" context="{'group_by': 'programme_id'}"/>
                        <filter string="Division" name="group_by_division" context="{'group_by': 'division_id'}"/>
                        <filter string="Thematic Area" name="group_by_thematic" context="{'group_by': 'thematic_area'}"/>
                    </group>
                </search>
            </field>
        </record>

    </data>
</odoo>
