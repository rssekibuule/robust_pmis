<?xml version="1.0" encoding="utf-8"?>
<templates>
    <t t-name="robust_pmis.UnifiedKPIDashboard">
        <div class="o_unified_kpi_dashboard">
            <div class="container-fluid">
                <div class="row mb-4">
                    <div class="col-12">
                        <h2 class="mb-3">
                            <i class="fa fa-tachometer-alt me-2"></i>
                            All Key Performance Indicators Dashboard
                        </h2>
                        <p class="text-muted">
                            Combined view of Strategic KPIs and Programme-level Performance Indicators
                        </p>
                    </div>
                </div>

                <div t-if="state.loading" class="text-center p-5">
                    <i class="fa fa-spinner fa-spin fa-3x text-muted"></i>
                    <p class="mt-3 text-muted">Loading KPI data...</p>
                </div>

                <div t-else="" class="row">
                    <!-- Summary Cards -->
                    <div class="col-lg-3 col-md-6 mb-4">
                        <div class="card border-primary h-100">
                            <div class="card-body text-center">
                                <div class="display-4 text-primary mb-2">
                                    <t t-esc="state.totalCount"/>
                                </div>
                                <h5 class="card-title text-primary">Total KPIs</h5>
                                <p class="card-text text-muted">Strategic + Programme</p>
                                <button class="btn btn-outline-primary btn-sm" t-on-click="openAllKPIs">
                                    View All
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-3 col-md-6 mb-4">
                        <div class="card border-success h-100">
                            <div class="card-body text-center">
                                <div class="display-4 text-success mb-2">
                                    <t t-esc="state.strategicCount"/>
                                </div>
                                <h5 class="card-title text-success">Strategic KPIs</h5>
                                <p class="card-text text-muted">Linked to KRAs</p>
                                <button class="btn btn-outline-success btn-sm" t-on-click="openStrategicKPIs">
                                    View Strategic
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-3 col-md-6 mb-4">
                        <div class="card border-info h-100">
                            <div class="card-body text-center">
                                <div class="display-4 text-info mb-2">
                                    <t t-esc="state.programmeCount"/>
                                </div>
                                <h5 class="card-title text-info">Programme KPIs</h5>
                                <p class="card-text text-muted">Programme Indicators</p>
                                <button class="btn btn-outline-info btn-sm" t-on-click="openProgrammeKPIs">
                                    View Programme
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-3 col-md-6 mb-4">
                        <div class="card border-warning h-100">
                            <div class="card-body text-center">
                                <div class="display-4 text-warning mb-2">
                                    <t t-esc="Math.round(state.avgPerformance)"/>%
                                </div>
                                <h5 class="card-title text-warning">Avg Performance</h5>
                                <p class="card-text text-muted">All KPIs Combined</p>
                                <div class="progress mt-2">
                                    <div class="progress-bar bg-warning" 
                                         role="progressbar" 
                                         t-att-style="`width: ${state.avgPerformance}%`"
                                         t-att-aria-valuenow="state.avgPerformance"
                                         aria-valuemin="0" 
                                         aria-valuemax="100">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent KPIs Tables -->
                <div class="row">
                    <div class="col-lg-6 mb-4">
                        <div class="card">
                            <div class="card-header bg-success text-white">
                                <h5 class="mb-0">
                                    <i class="fa fa-bullseye me-2"></i>
                                    Recent Strategic KPIs
                                </h5>
                            </div>
                            <div class="card-body p-0">
                                <div class="table-responsive">
                                    <table class="table table-hover mb-0">
                                        <thead class="table-light">
                                            <tr>
                                                <th>Name</th>
                                                <th>KRA</th>
                                                <th>Achievement</th>
                                                <th>Status</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr t-foreach="state.strategicKPIs.slice(0, 5)" t-as="kpi" t-key="kpi.id">
                                                <td>
                                                    <small class="fw-bold" t-esc="kpi.name"/>
                                                </td>
                                                <td>
                                                    <small class="text-muted" t-esc="kpi.kra_id[1] || 'N/A'"/>
                                                </td>
                                                <td>
                                                    <div class="progress" style="height: 8px;">
                                                        <div class="progress-bar bg-success" 
                                                             t-att-style="`width: ${kpi.achievement_percentage || 0}%`">
                                                        </div>
                                                    </div>
                                                    <small t-esc="`${Math.round(kpi.achievement_percentage || 0)}%`"/>
                                                </td>
                                                <td>
                                                    <span class="badge" 
                                                          t-att-class="`badge bg-${getStatusColor(kpi.status)}`">
                                                        <t t-esc="getStatusText(kpi.status)"/>
                                                    </span>
                                                </td>
                                            </tr>
                                            <tr t-if="state.strategicKPIs.length === 0">
                                                <td colspan="4" class="text-center text-muted p-4">
                                                    No strategic KPIs found
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-6 mb-4">
                        <div class="card">
                            <div class="card-header bg-info text-white">
                                <h5 class="mb-0">
                                    <i class="fa fa-chart-line me-2"></i>
                                    Recent Programme KPIs
                                </h5>
                            </div>
                            <div class="card-body p-0">
                                <div class="table-responsive">
                                    <table class="table table-hover mb-0">
                                        <thead class="table-light">
                                            <tr>
                                                <th>Name</th>
                                                <th>Programme</th>
                                                <th>Achievement</th>
                                                <th>Status</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr t-foreach="state.programmeKPIs.slice(0, 5)" t-as="kpi" t-key="kpi.id">
                                                <td>
                                                    <small class="fw-bold" t-esc="kpi.name"/>
                                                </td>
                                                <td>
                                                    <small class="text-muted" t-esc="kpi.parent_programme_id[1] || 'N/A'"/>
                                                </td>
                                                <td>
                                                    <div class="progress" style="height: 8px;">
                                                        <div class="progress-bar bg-info" 
                                                             t-att-style="`width: ${kpi.achievement_percentage || 0}%`">
                                                        </div>
                                                    </div>
                                                    <small t-esc="`${Math.round(kpi.achievement_percentage || 0)}%`"/>
                                                </td>
                                                <td>
                                                    <span class="badge" 
                                                          t-att-class="`badge bg-${getStatusColor(kpi.status)}`">
                                                        <t t-esc="getStatusText(kpi.status)"/>
                                                    </span>
                                                </td>
                                            </tr>
                                            <tr t-if="state.programmeKPIs.length === 0">
                                                <td colspan="4" class="text-center text-muted p-4">
                                                    No programme KPIs found
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-body text-center">
                                <h5 class="card-title">KPI Management Actions</h5>
                                <div class="btn-group" role="group">
                                    <button type="button" class="btn btn-primary" t-on-click="openAllKPIs">
                                        <i class="fa fa-list me-1"></i>
                                        View All KPIs
                                    </button>
                                    <button type="button" class="btn btn-success" t-on-click="openStrategicKPIs">
                                        <i class="fa fa-bullseye me-1"></i>
                                        Manage Strategic KPIs
                                    </button>
                                    <button type="button" class="btn btn-info" t-on-click="openProgrammeKPIs">
                                        <i class="fa fa-chart-line me-1"></i>
                                        Manage Programme KPIs
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </t>
</templates>
